<!DOCTYPE html>
<html lang="ja">

<head>
  <script>console.log("(・ὢ・)見たな....")</script>
  <!-- LINE Tag Base Code -->
  <!-- Do Not Modify -->
  <script>
      (function (g, d, o) {
        g._ltq = g._ltq || []; g._lt = g._lt || function () { g._ltq.push(arguments) };
        var h = location.protocol === 'https:' ? 'https://d.line-scdn.net' : 'http://d.line-cdn.net';
        var s = d.createElement('script'); s.async = 1;
        s.src = o || h + '/n/line_tag/public/release/v1/lt.js';
        var t = d.getElementsByTagName('script')[0]; t.parentNode.insertBefore(s, t);
      })(window, document);
    _lt('init', {
      customerType: 'account',
      tagId: '31e6eaa0-0503-4711-9940-9716a1439ba6'
    });
    _lt('send', 'pv', ['31e6eaa0-0503-4711-9940-9716a1439ba6']);
  </script>
  <noscript>
    <img height="1" width="1" style="display:none" src="https://tr.line.me/tag.gif?c_t=lap&t_id=31e6eaa0-0503-4711-9940-9716a1439ba6&e=pv&noscript=1" />
  </noscript>
  <!-- End LINE Tag Base Code -->
  <script>
    _lt('send', 'cv', {
      type: 'Conversion'
    }, ['31e6eaa0-0503-4711-9940-9716a1439ba6']);
  </script>

  <title>冒険2.0解析</title>
  <meta charset="utf-8">
  <meta name="description" content="何見てんだ">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
  <link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAIBAMAAAA2IaO4AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAElBMVEUAAAD/AAD/agD/2AD/9cb////TJc06AAAAAXRSTlMAQObYZgAAAAFiS0dEBfhv6ccAAAAHdElNRQflAwcFLhKuX9h3AAAAIElEQVQI12NgYGQAAiYBIMGsACOUDYCEiRGIcAZxjRgAGC0B3wrW1OEAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjEtMDMtMDdUMDU6NDY6MTgrMDA6MDAatoLBAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIxLTAzLTA3VDA1OjQ2OjE4KzAwOjAwa+s6fQAAAABJRU5ErkJggg==">
  <style>
    body {
      background: #eeeeee;
      font-family: 'YuGothic', 'Yu Gothic', 'Hiragino Kaku Gothic ProN', 'ヒラギノ角ゴ ProN W3', 'メイリオ', 'Meiryo', 'ＭＳ ゴシック', sans-serif;
    }

    .main:not(:last-child):after {
      white-space: pre;
      content: "\A";
    }

    .kye {
      width: 5rem;
      display: inline-block;
    }

    .value::before {
      content: ": ";
    }

    .input-text {
      border: unset;
      padding: initial;
      color: initial;
      background-color: initial;
      box-sizing: border-box;
    }
  </style>
</head>

<body>
  <div>
    <input type="button" value="load" onclick="load();">
    <input type="button" value="save" onclick="savedata.value=save();">
    <input type="text" id="savedata">
  </div>
  <div id="output"></div>
  <script>
    // original
    const removeChildAll = element => {
      let elementArray = [];
      kco += 1000;
      if (element.hasChildNodes()) {
        for (const i of element.children) {
          elementArray.push(i);
        }
        for (const i of elementArray) {
          i.remove();
        }
      }
      return elementArray;
    };
    const inputText = (value = false, width = false) => {
      if (value !== false) {
        let input = document.createElement("input");
        input.setAttribute("type", "text");
        input.classList.add("input-text");
        input.setAttribute("value", value);
        if (Number.isFinite(width)) {
          input.setAttribute("style", "width: " + width + "rem;");
        }
        return input;
      }
    };
    const dummy = () => {
      character = [];
      for (const i of document.getElementsByClassName("main")) {
        let dummyCharacter = [];
        for (let j = 1; j < i.children.length; j++) {
          dummyCharacter.push(i.children[j].children[1].children[0].value);
        }
        character.push(dummyCharacter);
      }
      player = document.getElementById("output").children[0].children[0].value - 1;
      n = document.getElementById("output").children[1].children[0].children[0].value;
    };
    let ad = [];


    const savedata = document.getElementById("savedata");
    let character = [];
    let kco = 0;
    let kcount = 0;
    let player = 0;
    let n = 0;
    let lastNumber = 0;

    const save = () => {
      dummy();

      let d = [[], [""], [""], [""]];
      for (const i of character) {
        let k;
        for (const j of i) {
          k = j.toString();
          for (let l = 0; l < k.length; l++) {
            d[0][l] = k.charCodeAt(l).toString(32);
          }
          d[1][1] = d[0].join("z");
          d[0] = [];
          d[1][0] = d[1].join("y");
        }
        d[2][1] = d[1][0].substr(1);
        d[1] = [""];
        d[2][0] = d[2].join("x");
      }
      d[2][0] = d[2][0].substr(1);
      d[2][1] = player;
      d[2][0] = d[2].join("w");
      d[2][1] = n;
      d[2][0] = d[2].join("w");
      d[2][1] = eval("kcount".substr(0, 6));
      d[2][0] = d[2].join("w");
      d[2][1] = eval("++" + "kcount".substr(0, 3));
      d[2][0] = d[2].join("w");
      for (let i = d[2][1] = 0; i < d[2][0].length; i++) {
        d[2][1] = (d[2][1] + d[2][0].charCodeAt(i)) % (10 ** 10);
      }
      return d[2][0] = d[2].join("a");
    };/*saveする*/
    const load = (a = savedata.value) => {
      if (a != "") {
        let d = 0;
        for (let i = 0; i < a.slice(0, a.lastIndexOf("a")).length; i++) {
          d = (d + a.charCodeAt(i)) % (10 ** 10);
        }
        let q = [[]];
        if (a.slice(1 + a.lastIndexOf("a")) - 0 == d) {
          /*書き出し*/
          q = a.slice(0, a.lastIndexOf("a")).split("w");
          q[0] = q[0].split("x");
          for (let j = 0; j < q[0].length; j++) {
            q[0][j] = q[0][j].split("y");
            for (let k = 0; k < q[0][j].length; k++) {
              q[0][j][k] = q[0][j][k].split("z");
              for (let l = 0; l < q[0][j][k].length; l++) {
                q[0][j][k][l] = parseInt(q[0][j][k][l], 32);
              }
              q[0][j][k] = String.fromCharCode.apply(null, q[0][j][k]);
              if (k > 0 && k != 11) {
                q[0][j][k] = q[0][j][k] - 0;
              }
            }
          }
          for (let i = 1; i < q.length; i++) {
            q[i] -= 0;
          }
          /*書き込み*/
          // fc(1);
          for (let i = 0; i < q[0].length; i++) {
            character[i] = q[0][i];
          }
          // who(q[1]);
          // document.getElementById("kcount").innerHTML = q[3];
          eval("kcount".substr(0, 6) + " = q[3]");
          eval("kcount".substr(0, 3) + " = q[4]");
          // ((n = q[2]) < 13) ? whoe(n + (n < 2 ? 3 : n < 5 ? 2 : n < 9 ? 0 : n > 9 ? -2 : -1)) : f[11]();
          // change(0, 1, 2, 6);
          for (let i = 0; i < 4; i++) {
            // wris(i);
            // (character[i][8] == 3) && (youjo++);
            // if (character[i][1] <= 0) {
            //   document.getElementById("deathmessage").innerHTML = "もうだめ";
            //   document.getElementById("writekc").innerHTML = kcount;
            //   change(0, 7, 9);
            // }
            if (character[character.length - 1][1] == 0) {
              // f[11]();
            } else {
              character[character.length - 1][1] = character[character.length - 1][9];
            }
          }
          // document.getElementById("player").innerHTML = character[player][0];

          // original
          player = q[1];
          n = q[2];
          characteroutput();

          return 0;
        } else return 1;
      } else return 1;
    };


    // original
    const output = document.getElementById("output");
    const kye = ["name", "hp", "mp", "str", "def", "mnd", "luk", "lv", "role", "maxhp", "maxmp", "rolename", "box"];
    const numberChange = a => {
      n = parseInt(a.value, 10);
      a.parentNode.nextElementSibling.innerHTML = n + (n < 2 ? 3 : n < 5 ? 2 : n < 9 ? 0 : n > 9 ? -2 : -1) + 1;
    };
    const characteroutput = () => {
      // return 0;
      console.log(removeChildAll(output));

      let who = document.createElement("div");
      who.innerHTML = "行動するキャラクターは";
      who.appendChild(inputText(player + 1, 1));
      who.innerHTML += "番目です。";
      output.appendChild(who);
      let number = document.createElement("div");
      number.innerHTML = "現在対峙しているキャラクターは";
      let enemyNumber = document.createElement("span");
      enemyNumber.appendChild(inputText(n, 1));
      enemyNumber.children[0].setAttribute("onchange", "numberChange(this)");
      number.appendChild(enemyNumber);
      number.innerHTML += "回目の";
      let enemyWho = document.createElement("span");
      enemyWho.innerHTML = n + (n < 2 ? 3 : n < 5 ? 2 : n < 9 ? 0 : n > 9 ? -2 : -1) + 1;
      number.appendChild(enemyWho);
      number.innerHTML += "番目です。";
      if (n >= 13) {
        number.innerHTML += "戦闘は終了しています。";
      }
      output.appendChild(number);
      for (let i = 0; i < character.length; i++) {
        let divmain = document.createElement("div");
        divmain.classList.add("main");
        let divnumver = document.createElement("div");
        divnumver.innerHTML = i + 1;
        divmain.appendChild(divnumver);
        for (let j = 0; j < character[i].length; j++) {
          let divsub = document.createElement("div");
          let spankye = document.createElement("span");
          spankye.classList.add("kye");
          let spanvalue = document.createElement("span");
          spanvalue.classList.add("value");
          spankye.innerHTML = kye[j];
          spanvalue.appendChild(inputText(character[i][j]));
          divsub.appendChild(spankye);
          divsub.appendChild(spanvalue);
          divmain.appendChild(divsub);
        }
        output.appendChild(divmain);
      }
      // let last = document.createElement("soan")
      // output.children[output.children.length - 1].appendChild()
    };
  </script>
</body>

</html>
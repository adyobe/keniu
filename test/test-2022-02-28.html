<!DOCTYPE html>
<html lang="ja">

<head>
  <script>console.log("(・ὢ・)見たな....")</script>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>test-2022-02-28</title>
  <style>
    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    p {
      margin: 0;
      font-size: medium;
    }

    article {
      margin: 2rem 0;
    }
  </style>
</head>

<body>
  <main>
    <article>
      <article>
        <h1>階乗計算</h1>
        <p>階乗を計算します。</p>
        <div>
          <div>
            <textarea id="factorialOutput" style="overflow: hidden;">出力</textarea>
          </div>
          <div>
            <input type="number" min="0" id="factorialInput">
          </div>
        </div>
      </article>
      <article>
        <h1>素数判定</h1>
        <p>素数かどうかを判定します。</p>
        <div>
          <div>
            <textarea id="primalityTestOutput" style="overflow: hidden;">出力</textarea>
          </div>
          <div>
            <input type="number" min="0" id="primalityTestInput">
          </div>
        </div>
      </article>
      <article>
        <h1>素数列挙</h1>
        <p>入力以下の素数一覧を表示します。</p>
        <div>
          <div>
            <textarea id="primeListOutput" style="overflow: hidden;">出力</textarea>
          </div>
          <div>
            <input type="number" min="0" id="primeListInput">
          </div>
        </div>
      </article>
      <article>
        <h1>素数計数</h1>
        <p>入力以下の素数の個数を数えます。</p>
        <div>
          <div>
            <textarea id="primeCountOutput" style="overflow: hidden;">出力</textarea>
          </div>
          <div>
            <input type="number" min="0" id="primeCountInput">
          </div>
        </div>
      </article>
    </article>
  </main>
  <div id="temporaryFunction">
    (() => {
    console.log("version 1.0.0");
    console.log("最終更新2022/02/28");
    document.getElementById("temporaryFunction").remove()})()
    <!-- よく来たね -->
  </div>
  <script src="../assets/js/adb.js"></script>
  <script id="temporaryScript">
      (() => {
        let temporaryFunction_element = document.getElementById("temporaryFunction");
        let script_element = document.createElement("script");
        script_element.innerHTML = temporaryFunction_element.textContent;
        temporaryFunction_element.appendChild(script_element);
      })();

    function isElement(obj) {
      try {
        return obj instanceof HTMLElement;
      }
      catch (error) {
        console.log(error);
        return (typeof obj === "object") && (obj.nodeType === 1) && (typeof obj.style === "object") && (typeof obj.ownerDocument === "object");
      }
    }
    function autoTextarea(element, text = "", focusElement) {
      element.value = text;
      element.style.height = "0px";
      element.style.height = element.scrollHeight + parseInt(window.getComputedStyle(element).height) - element.clientHeight + "px";
      if (isElement(focusElement)) { focusElement.scrollIntoView(false); }
      return text;
    }


    /* 階乗計算 */
    function factorial(number = 0) {
      if (typeof number === "bigint") {
        if (number <= 0n) { number = 1n; }
      } else if (Number.isInteger(number) && number > 0) {
        number = BigInt(number);
      } else { number = 1n; }
      let counter = 1n;
      for (let i = 2n; i <= number; i++) { counter *= i; }
      return counter;
    }
    function factorialInput_function() {
      autoTextarea(document.querySelector("#factorialOutput"), factorial(parseInt(this.value)), document.querySelector("#factorialInput"));
    }
    document.querySelector("#factorialInput").addEventListener("change", factorialInput_function, { passive: true });
    /* 階乗計算 */


    /* 素数判定 */
    const primeSort = (() => {
      let primeArray = [2];
      return function (number = 1) {
        if (Number.isInteger(number) && number > primeArray[primeArray.length - 1]) {
          let start = primeArray[primeArray.length - 1] + 1;
          let end = number + 1;
          for (let i = start; i < end; i++) {
            const sqrt = Math.floor(Math.sqrt(i));
            let isPrime = true;
            for (let j = 0; j < primeArray.length; j++) {
              const prime = primeArray[j];
              if (sqrt < prime) { break; }
              isPrime = i % prime != 0;
              if (!isPrime) { break; }
            }
            if (isPrime) { primeArray.push(i); }
          }
        }
        return primeArray;
      };
    })();
    function primalityTest(number = 1) {
      if (Number.isInteger(number) && number > 1) {
        return primeSort(number).includes(number);
      } else {
        return false;
      }
    }
    function primalityTestInput_function() {
      let val = parseInt(this.value);
      autoTextarea(document.querySelector("#primalityTestOutput"), `${val}は素数で${primalityTest(val) ? "す" : "はありません"}。`, document.querySelector("#primalityTestInput"));
    }
    document.querySelector("#primalityTestInput").addEventListener("change", primalityTestInput_function, { passive: true });
    /* 素数判定 */


    /* 素数列挙 */
    function primeListInput_function() {
      let val = parseInt(this.value);
      let arr = primeSort(val);
      let i = arr.length;
      while (i-- > 0) { if (arr[i] <= val) { break; } }
      autoTextarea(document.querySelector("#primeListOutput"), arr.slice(0, i + 1), document.querySelector("#primeListInput"));
    }
    document.querySelector("#primeListInput").addEventListener("change", primeListInput_function, { passive: true });
    /* 素数列挙 */


    /* 素数計数,計上 */
    function primeCounting(number = 1) {
      let arr = primeSort(number);
      let i = arr.length;
      while (i-- > 0) { if (arr[i] <= number) { break; } }
      return i + 1;
    }
    function primeCountInput_function() {
      autoTextarea(document.querySelector("#primeCountOutput"), primeCounting(parseInt(this.value)), document.querySelector("#primeCountInput"));
    }
    document.querySelector("#primeCountInput").addEventListener("change", primeCountInput_function, { passive: true });
    /* 素数計数,計上 */


    // 見つかったかぁ
    // document.getElementById("temporaryScript").remove();
    [...document.querySelectorAll("script")].forEach(e => e.remove());
  </script>
</body>

</html>
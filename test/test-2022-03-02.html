<!DOCTYPE html>
<html lang="ja">

<head>
  <script>console.log("(・ὢ・)見たな....")</script>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>test-2022-03-02</title>
  <script src="../JS/adb.js"></script>
  <style>
    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    p {
      margin: 0;
      font-size: medium;
    }

    article {
      margin: 2rem 0;
    }
  </style>
</head>

<body>
  <div id="body">
    <main>
      <div id="message">
        <div id="output"></div>
      </div>
      <div id="select">
        <input type="text" id="input">
        <button id="button">決定</button>
      </div>
    </main>
  </div>
  <script>
    const output_element = document.querySelector("#output");
    const input_element = document.querySelector("#input");
    const button_element = document.querySelector("#button");
    function mes(text) {
      let div = document.createElement("div");
      div.innerHTML = text.replaceAll(/\n/g, "<br>");
      output_element.appendChild(div);
      return output_element.textContent;
    }
    function mesReset() {
      let text = output_element.textContent;
      output_element.innerHTML = "";
      return text;
    }
    button_element.addEventListener("click", button_function);
    function button_function() {
      return main(input_element.value);
    }

    const roruno = [
      {
        message: ["ここは大きな迷路の庭。あなたはここへ半角空白の謎を追ってきました。\nわたがし侍「どうしようか？」"],
        select: [
          ["moveFront", "true"],
          ["moveBack", "false"],
          ["moveLeft", "false"],
          ["moveRight", "false"],
          ["moveUp", "false"],
          ["movedown", "false"],
          ["search", "true"],
          ["call", "true"],
          ["talkMe", "true"],
          ["talkBlack", "true"],
          ["talkSamurai", "true"],
          ["talkHill", "true"],
          ["talkWalnut", "true"],
        ],
      },
    ];
    const status = {
      now: 0,
      map: 0,
      item: [],
      select: {
        moveFront: false,
        moveBack: false,
        moveLeft: false,
        moveRight: false,
        moveUp: false,
        movedown: false,
        search: false,
        call: false,
        talkMe: false,
        talkBlack: false,
        talkSamurai: false,
        talkHill: false,
        talkWalnut: false,
      },
      preview: "none",
      talk: ["talkMe", "talkBlack", "talkSamurai", "talkHill", "talkWalnut"],
      character: {
        me: {
          name: "あなた",
        },
        black: {
          name: "墨染桜",
        },
        samurai: {
          name: "わたがし侍",
        },
        hill: {
          name: "豊かな丘",
        },
        walnut: {
          name: "胡桃割り",
        },
      }
    };
    const action_function = {
      moveFront: function () {
        status.preview = "moveFront";
      },
      moveBack: function () {
        status.preview = "moveBack";
      },
      moveLeft: function () {
        status.preview = "moveLeft";
      },
      moveRight: function () {
        status.preview = "moveRight";
      },
      moveUp: function () {
        status.preview = "moveUp";
      },
      movedown: function () {
        status.preview = "movedown";
      },
      search: function () { },
      call: function () { },
      talkMe: function () { },
      talkBlack: function () { },
      talkSamurai: function () { },
      talkHill: function () { },
      talkWalnut: function () { },
      none: function () { return status.now; },
    };
    function filter(text = "") {
      if (/^(前[へに])?進む$/.test(text)) {
        return "moveFront";
      } else if (/^後ろ[へに]進む$/.test(text)) {
        return "moveBack";
      } else if (/^左[へに]進む$/.test(text)) {
        return "moveLeft";
      } else if (/^右[へに]進む$/.test(text)) {
        return "moveRight";
      } else if (/^(上[へに]進む|上る)$/.test(text)) {
        return "moveUp";
      } else if (/^(下[へに]進む|下る)$/.test(text)) {
        return "moveDown";
      } else if (/^戻る$/.test(text)) {
        return status.preview;
      } else if (/^(誰かと)?話す$/.test(text)) {
        return status.talk[Math.floor(Math.random() * status.talk.length)];
      } else if (/^自分と話す$/.test(text)) {
        return "talkMe";
      } else if (/^墨染桜と話す$/.test(text)) {
        return "talkBlack";
      } else if (/^わたがし侍と話す$/.test(text)) {
        return "talkSamurai";
      } else if (/^豊かな丘と話す$/.test(text)) {
        return "talkHill";
      } else if (/^胡桃割りと話す$/.test(text)) {
        return "talkWalnut";
        // } else if (/^$/.test(text)) {
      } else {
        return "none";
      }
    }
    const select_function = {
      true: function () { return true; },
      false: function () { return false; },
    }

    function main(text = "") {
      let response = roruno[action_function[filter(text)]()];
      mesReset();
      response.message.forEach(e => mes(e));
      response.select.forEach(e => status.select[e[0]] = select_function[e[1]]());
    }
    main();
  </script>
  <div id="temporaryFunction">
    (() => {
    console.log("version 1.0.0");
    console.log("最終更新2022/03/02");
    document.getElementById("temporaryFunction").remove()})()
    <!-- よく来たね -->
  </div>
  <script>
    (() => {
      let temporaryFunction_element = document.getElementById("temporaryFunction");
      let script_element = document.createElement("script");
      script_element.innerHTML = temporaryFunction_element.textContent;
      temporaryFunction_element.appendChild(script_element);
      [...document.querySelectorAll("script")].forEach(e => e.remove());
    })();
  </script>
</body>

</html>